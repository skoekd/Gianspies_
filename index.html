<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Dough Calculator - Professional Recipe Builder</title>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script>
    (function(){
      function show(msg){
        var root = document.getElementById('root');
        if(!root) { return; }
        root.innerHTML = '';
        var pre = document.createElement('pre');
        pre.style.whiteSpace = 'pre-wrap';
        pre.style.padding = '16px';
        pre.style.margin = '16px auto';
        pre.style.maxWidth = '900px';
        pre.style.background = 'rgba(255,255,255,0.85)';
        pre.style.border = '1px solid rgba(0,0,0,0.12)';
        pre.style.borderRadius = '12px';
        pre.style.fontFamily = "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
        pre.textContent = msg;
        root.appendChild(pre);
      }

      function ready(fn){
        if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', fn);
        else fn();
      }

      ready(function(){
        var err = null;
        if(!window.React) err = 'React failed to load. Check network / CDN availability.';
        else if(!window.ReactDOM) err = 'ReactDOM failed to load. Check network / CDN availability.';
        else if(!window.Babel) err = 'Babel failed to load. Check network / CDN availability.';
        if(err){ show(err); return; }

        try {
          if(!window.__BABEL_TRANSFORMED__){
            window.__BABEL_TRANSFORMED__ = true;
            if(window.Babel && typeof window.Babel.transformScriptTags === 'function') {
              window.Babel.transformScriptTags();
            }
          }
        } catch(e){
          show('Babel compile failed:\n\n' + (e && e.stack ? e.stack : String(e)));
        }
      });
    })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --wheat: #F5E6D3;
            --wheat-dark: #E8D4B8;
            --flour: #FFFEF9;
            --dough: #DFC998;
            --crust: #8B6F47;
            --char: #3A3226;
            --tomato: #C74844;
            --basil: #5C8A4A;
            --shadow: rgba(58, 50, 38, 0.1);
            --shadow-strong: rgba(58, 50, 38, 0.2);
        }

        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, var(--flour) 0%, var(--wheat) 100%);
            min-height: 100vh;
            color: var(--char);
            padding: 2rem 1rem;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 0.6s ease-out;
        }

        .header h1 {
            font-family: 'Crimson Pro', serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            color: var(--char);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--crust);
            font-weight: 300;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            animation: fadeIn 0.8s ease-out 0.2s both;
        }

        .tabs {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 254, 249, 0.92);
            backdrop-filter: blur(8px);
            border: 1px solid var(--wheat-dark);
            border-radius: 14px;
            padding: 0.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 6px 22px var(--shadow);
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tab-btn {
            border: 2px solid var(--wheat-dark);
            background: white;
            color: var(--crust);
            border-radius: 10px;
            padding: 0.6rem 0.85rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            border-color: var(--tomato);
            transform: translateY(-1px);
        }

        .tab-btn.active {
            background: var(--tomato);
            border-color: var(--tomato);
            color: white;
        }

        .health-box {
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid var(--wheat-dark);
            background: white;
            margin-bottom: 1rem;
        }

        .health-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.6rem;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.85rem;
            border: 1px solid var(--wheat-dark);
        }

        .health-green { background: rgba(92, 138, 74, 0.12); color: var(--basil); }
        .health-yellow { background: rgba(223, 201, 152, 0.35); color: #7A5A1F; }
        .health-red { background: rgba(199, 72, 68, 0.14); color: var(--tomato); }

        @media (max-width: 968px) {
            .tabs { border-radius: 12px; }
            .tab-btn { flex: 1 1 auto; text-align: center; }
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 24px var(--shadow), 0 0 0 1px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px var(--shadow-strong), 0 0 0 1px var(--shadow);
        }

        .card-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--char);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 1.75rem;
            background: var(--tomato);
            border-radius: 2px;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--crust);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-field, .select-field {
            width: 100%;
            padding: 0.875rem 1rem;
            font-size: 1rem;
            border: 2px solid var(--wheat-dark);
            border-radius: 8px;
            background: var(--flour);
            color: var(--char);
            font-family: 'Work Sans', sans-serif;
            transition: all 0.3s ease;
        }

        .input-field:focus, .select-field:focus {
            outline: none;
            border-color: var(--tomato);
            background: white;
            box-shadow: 0 0 0 3px rgba(199, 72, 68, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .style-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .style-button {
            padding: 1rem;
            border: 2px solid var(--wheat-dark);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Work Sans', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--crust);
        }

        .style-button:hover {
            border-color: var(--tomato);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .style-button.active {
            border-color: var(--tomato);
            background: var(--tomato);
            color: white;
        }

        .results-section {
            background: linear-gradient(135deg, var(--wheat) 0%, var(--wheat-dark) 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--char);
        }

        .ingredient-list {
            display: grid;
            gap: 0.75rem;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .ingredient-name {
            font-weight: 500;
            color: var(--char);
        }

        .ingredient-amount {
            font-family: 'Crimson Pro', serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--tomato);
        }

        .timeline-section {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--basil);
        }

        .timeline-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--wheat-dark);
        }

        .timeline-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .timeline-item.highlight {
            background: linear-gradient(135deg, #FFF9E6 0%, #FFEFC1 100%);
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid var(--tomato);
            box-shadow: 0 2px 8px rgba(199, 72, 68, 0.2);
        }

        .timeline-time {
            font-family: 'Crimson Pro', serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--tomato);
            min-width: 120px;
        }

        .timeline-text {
            color: var(--char);
            line-height: 1.6;
        }

        .warning-box {
            background: #FFF3CD;
            border-left: 4px solid #FFC107;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #856404;
        }

        .info-box {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #0D47A1;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .button {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .button-primary {
            background: var(--tomato);
            color: white;
        }

        .button-primary:hover {
            background: #B33F3B;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(199, 72, 68, 0.3);
        }

        .button-secondary {
            background: white;
            color: var(--char);
            border: 2px solid var(--wheat-dark);
        }

        .button-secondary:hover {
            border-color: var(--crust);
            transform: translateY(-2px);
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--wheat-dark);
            transition: 0.4s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--tomato);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .flour-blend {
            display: grid;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .flour-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--flour);
            border-radius: 6px;
            border: 1px solid var(--wheat-dark);
        }

        .hydration-indicator {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .hydration-bar {
            height: 24px;
            background: var(--wheat);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .hydration-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--basil), var(--tomato));
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .recipe-name-input {
            margin-bottom: 1.5rem;
        }

        .saved-recipes {
            max-height: 300px;
            overflow-y: auto;
        }

        .saved-recipe-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--flour);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .saved-recipe-item:hover {
            background: var(--wheat);
            transform: translateX(4px);
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--tomato);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem 0.5rem;
        }

        .delete-btn:hover {
            color: #B33F3B;
        }
    </style>
</head>
<body>
    <div id="root">Loading...</div>

    <script type="text/babel" data-presets="env,react">
        window.addEventListener('error', (e) => {
            const container = document.getElementById('root');
            if (!container) return;
            if (container.dataset && container.dataset.hasApp === '1') return;
            container.innerHTML = '';
            const pre = document.createElement('pre');
            pre.style.whiteSpace = 'pre-wrap';
            pre.style.padding = '16px';
            pre.style.margin = '16px auto';
            pre.style.maxWidth = '900px';
            pre.style.background = 'rgba(255,255,255,0.8)';
            pre.style.border = '1px solid rgba(0,0,0,0.1)';
            pre.style.borderRadius = '12px';
            pre.style.fontFamily = "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
            pre.textContent = 'Uncaught error\n\n' + (e.error && e.error.stack ? e.error.stack : (e.message || String(e)));
            container.appendChild(pre);
        });

        const { useState, useEffect } = React;

        const FLOUR_DATABASE = {
            'casillo-la8': {
                name: 'Casillo La 8 Plus Tipo 0',
                protein: 14.1,
                w: 350,
                pl: 0.60,
                type: 'Tipo 0',
                hasWheatGerm: true,
                bestUse: 'Backbone/structure, long ferments',
                watchOuts: 'Wheat germ enzyme activity'
            },
            'casillo-superiore': {
                name: 'Casillo Pizza Superiore Tipo 0',
                protein: 13.5,
                w: 340,
                pl: 0.55,
                type: 'Tipo 0',
                hasWheatGerm: false,
                bestUse: 'Primary pizza flour',
                watchOuts: 'Above 75-80% hydration needs care'
            },
            'casillo-aroma': {
                name: 'Casillo Aroma Type 1',
                protein: 13.0,
                w: 280,
                pl: 0.75,
                type: 'Type 1',
                hasWheatGerm: true,
                bestUse: 'Flavor, color, crispness',
                watchOuts: 'Best 10-25% blend'
            },
            'caputo-blue': {
                name: 'Caputo 00 Blue',
                protein: 12.5,
                w: 270,
                pl: 0.55,
                type: '00',
                hasWheatGerm: false,
                bestUse: 'Classic Neapolitan 60-65%',
                watchOuts: 'Less ideal for long ferments'
            }
        };

        const PIZZA_STYLES = {
            'daniel-gigi': {
                name: 'Daniel Gigi Style',
                hydration: 87.5,
                salt: 2.8,
                flourBlend: [
                    { flourId: 'casillo-la8', percentage: 50 },
                    { flourId: 'casillo-superiore', percentage: 35 },
                    { flourId: 'casillo-aroma', percentage: 15 }
                ],
                fermentMethod: 'biga',
                bigaHydration: 65,
                bigaPercentage: 50,
                diastatic: 0.4,
                timeline: { biga: 17, bulk: 0.75, cold: 60, proof: 2.5 },
                bakeTemp: { wood: 480, home: 260 },
                bakeTime: { wood: 1.5, home: 7 }
            },
            'contemporary': {
                name: 'Contemporary Pizza',
                hydration: 80,
                salt: 2.5,
                flourBlend: [
                    { flourId: 'casillo-superiore', percentage: 60 },
                    { flourId: 'casillo-la8', percentage: 30 },
                    { flourId: 'casillo-aroma', percentage: 10 }
                ],
                fermentMethod: 'biga',
                bigaHydration: 60,
                bigaPercentage: 40,
                diastatic: 0.3,
                timeline: { biga: 16, bulk: 1, cold: 48, proof: 3 },
                bakeTemp: { wood: 400, home: 250 },
                bakeTime: { wood: 2, home: 7 }
            },
            'neapolitan': {
                name: 'Neapolitan',
                hydration: 62,
                salt: 2.5,
                flourBlend: [
                    { flourId: 'caputo-blue', percentage: 100 }
                ],
                fermentMethod: 'direct',
                diastatic: 0,
                timeline: { bulk: 2, cold: 24, proof: 4 },
                bakeTemp: { wood: 485, home: 260 },
                bakeTime: { wood: 1, home: 6 }
            },
            'ny-style': {
                name: 'New York Style',
                hydration: 63,
                salt: 2,
                oil: 2,
                sugar: 2,
                flourBlend: [
                    { flourId: 'casillo-superiore', percentage: 100 }
                ],
                fermentMethod: 'direct',
                timeline: { bulk: 2, cold: 48, proof: 3 },
                bakeTemp: { wood: 370, home: 260 },
                bakeTime: { wood: 5, home: 12 }
            },
            'detroit': {
                name: 'Detroit Style',
                hydration: 72,
                salt: 2.2,
                oil: 3,
                flourBlend: [
                    { flourId: 'casillo-superiore', percentage: 100 }
                ],
                fermentMethod: 'direct',
                timeline: { bulk: 2, cold: 24, proof: 3 },
                bakeTemp: { wood: 260, home: 260 },
                bakeTime: { wood: 12, home: 12 }
            },
            'roman': {
                name: 'Roman al Taglio',
                hydration: 78,
                salt: 2.5,
                oil: 3,
                flourBlend: [
                    { flourId: 'casillo-superiore', percentage: 70 },
                    { flourId: 'caputo-blue', percentage: 30 }
                ],
                fermentMethod: 'biga',
                bigaHydration: 55,
                bigaPercentage: 30,
                diastatic: 0.3,
                timeline: { biga: 16, bulk: 1, cold: 24, proof: 3 },
                bakeTemp: { wood: 300, home: 230 },
                bakeTime: { wood: 15, home: 15 }
            }
        };

        function PizzaCalculator() {
            const [activeTab, setActiveTab] = useState('setup');
            const [pizzaStyle, setPizzaStyle] = useState('daniel-gigi');
            const [numPizzas, setNumPizzas] = useState(4);
            const [doughBallWeight, setDoughBallWeight] = useState(280);
            const [roomTemp, setRoomTemp] = useState(22);
            const [flourTemp, setFlourTemp] = useState(20);
            const [fridgeTemp, setFridgeTemp] = useState(3.5);
            const [desiredFDT, setDesiredFDT] = useState(24);
            const [mixerType, setMixerType] = useState('medium-high');
            const [showBakersPercentage, setShowBakersPercentage] = useState(false);
            const [customHydration, setCustomHydration] = useState(null);
            const [customBigaPercent, setCustomBigaPercent] = useState(null);
            const [customBigaHydration, setCustomBigaHydration] = useState(null);
            const [customBigaYeastPercent, setCustomBigaYeastPercent] = useState(0.30);
            const [savedRecipes, setSavedRecipes] = useState([]);
            const [recipeName, setRecipeName] = useState('');
            const [timelineMode, setTimelineMode] = useState('forward');
            const [bakeDateTime, setBakeDateTime] = useState('');
            const [bigaTemp, setBigaTemp] = useState(13);
            const [bulkTemp, setBulkTemp] = useState(22);
            const [proofTemp, setProofTemp] = useState(18);
            const [customBigaHours, setCustomBigaHours] = useState(null);
            const [customBulkHours, setCustomBulkHours] = useState(null);
            const [customColdHours, setCustomColdHours] = useState(null);
            const [customProofHours, setCustomProofHours] = useState(null);
            const [useLemadyYeast, setUseLemadyYeast] = useState(false);
            const [ovenType, setOvenType] = useState('home');
            const [yeastType, setYeastType] = useState('instant');

            useEffect(() => {
                const saved = localStorage.getItem('pizzaRecipes');
                if (saved) {
                    setSavedRecipes(JSON.parse(saved));
                }
            }, []);

            const switchTab = (tabKey) => {
                setActiveTab(tabKey);
                try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch (e) {}
            };

            const FRICTION_FACTORS = {
                'hand': 6,
                'no-knead': 0,
                'low': 14,
                'medium': 22,
                'spiral-low': 18,
                'spiral-high': 22,
                'medium-high': 26,
                'high': 28
            };

            const calculateFermentationHours = (baseHours, baseTemp, actualTemp) => {
                const tempDiff = actualTemp - baseTemp;
                const q10Factor = Math.pow(2, tempDiff / 10);
                return baseHours / q10Factor;
            };

            const getBigaHours = () => {
                if (customBigaHours !== null) return customBigaHours;
                return calculateFermentationHours(17, 13, bigaTemp);
            };

            const getBulkHours = () => {
                if (customBulkHours !== null) return customBulkHours;
                const baseHours = styleConfig.fermentMethod === 'biga' ? 0.75 : 2;
                return calculateFermentationHours(baseHours, 22, bulkTemp);
            };

            const getColdFermentHours = () => {
                if (customColdHours !== null) return customColdHours;
                const baseHours = styleConfig.timeline.cold || 48;
                return calculateFermentationHours(baseHours, 3.5, fridgeTemp);
            };

            const getProofHours = () => {
                if (customProofHours !== null) return customProofHours;
                const baseHours = styleConfig.timeline.proof || 3;
                return calculateFermentationHours(baseHours, 18, proofTemp);
            };

            const styleConfig = PIZZA_STYLES[pizzaStyle];
            const hydration = customHydration || styleConfig.hydration;
            const bigaPercent = (customBigaPercent !== null && !Number.isNaN(customBigaPercent)) ? customBigaPercent : (styleConfig.bigaPercentage || 0);
            const bigaHydration = (customBigaHydration !== null && !Number.isNaN(customBigaHydration)) ? customBigaHydration : (styleConfig.bigaHydration || 0);
            const bigaYeastPct = (customBigaYeastPercent !== null && !Number.isNaN(customBigaYeastPercent)) ? customBigaYeastPercent : 0.30;

            const totalDough = numPizzas * doughBallWeight;
            const totalFlour = Math.round(totalDough / (1 + (hydration / 100) + (styleConfig.salt / 100) + ((styleConfig.oil || 0) / 100) + ((styleConfig.sugar || 0) / 100) + ((styleConfig.diastatic || 0) / 100)));

            const frictionFactor = FRICTION_FACTORS[mixerType];
            const waterTemp = Math.round((desiredFDT * 4) - flourTemp - roomTemp - frictionFactor);

            const YEAST_CONVERSIONS = {
                'instant': 1.0,
                'active-dry': 1.25,
                'fresh': 3.0,
                'lemady': 1.0
            };

            const calculateAverageFermentTemp = () => {
                const bigaHours = getBigaHours();
                const bulkHours = getBulkHours();
                const coldHours = getColdFermentHours();
                const proofHours = getProofHours();
                const totalHours = bigaHours + bulkHours + coldHours + proofHours;
                
                if (totalHours === 0) return 15;
                
                const weightedTemp = (
                    bigaHours * bigaTemp +
                    bulkHours * bulkTemp +
                    coldHours * fridgeTemp +
                    proofHours * proofTemp
                ) / totalHours;
                
                return weightedTemp;
            };

            const totalFermentHours = getBigaHours() + getBulkHours() + getColdFermentHours() + getProofHours();
            
            let baseYeast;
            if (totalFermentHours >= 90) baseYeast = 0.15;
            else if (totalFermentHours >= 60) baseYeast = 0.2;
            else if (totalFermentHours >= 30) baseYeast = 0.4;
            else baseYeast = 0.8;
            
            const avgTemp = calculateAverageFermentTemp();
            let tempFactor = 1.0;
            if (avgTemp > 18) tempFactor = 0.9;
            else if (avgTemp < 12) tempFactor = 1.1;
            
            const saltPercent = styleConfig.salt;
            let saltFactor = 1.0;
            if (saltPercent > 2.5) saltFactor = 1.1;
            else if (saltPercent < 2) saltFactor = 0.9;
            
            let hydrationFactor = 1.0;
            if (hydration > 75) hydrationFactor = 0.95;
            else if (hydration < 65) hydrationFactor = 1.05;
            
            const instantYeastPct = baseYeast * tempFactor * saltFactor * hydrationFactor;
            const yeastPercentage = instantYeastPct * YEAST_CONVERSIONS[yeastType];
            const totalYeast = (totalFlour * yeastPercentage / 100).toFixed(1);

            const yeastCalc = {
                baseYeast,
                tempFactor,
                saltFactor,
                hydrationFactor,
                avgTemp,
                instantYeastPct,
                totalHours: totalFermentHours
            };

            let ingredients = {};

            if (styleConfig.fermentMethod === 'biga') {
                const bigaFlour = Math.round(totalFlour * (bigaPercent / 100));
                const bigaWater = Math.round(bigaFlour * (bigaHydration / 100));
                const bigaYeast = (bigaFlour * (bigaYeastPct / 100)).toFixed(1);

                const finalFlour = totalFlour - bigaFlour;
                const totalWater = Math.round(totalFlour * (hydration / 100));
                const finalWater = totalWater - bigaWater;

                const yeastDiff = parseFloat(totalYeast) - parseFloat(bigaYeast);
                const yeastWasClamped = yeastDiff < 0;
                const finalYeastVal = Math.max(0, yeastDiff);
                const finalYeast = finalYeastVal.toFixed(1);

                ingredients = {
                    biga: {
                        flour: bigaFlour,
                        water: bigaWater,
                        yeast: bigaYeast
                    },
                    final: {
                        flour: finalFlour,
                        water: finalWater,
                        salt: Math.round(totalFlour * (styleConfig.salt / 100)),
                        yeast: finalYeast,
                        ...(styleConfig.diastatic && { diastatic: (totalFlour * styleConfig.diastatic / 100).toFixed(1) }),
                        ...(styleConfig.oil && { oil: Math.round(totalFlour * styleConfig.oil / 100) }),
                        ...(styleConfig.sugar && { sugar: Math.round(totalFlour * styleConfig.sugar / 100) })
                    },
                    totals: {
                        flour: totalFlour,
                        water: Math.round(totalFlour * (hydration / 100)),
                        salt: Math.round(totalFlour * (styleConfig.salt / 100)),
                        yeast: totalYeast
                    },
                    meta: {
                        bigaPercent,
                        bigaHydration,
                        bigaYeastPct,
                        finalWaterNegative: finalWater < 0,
                        totalYeastLessThanBiga: parseFloat(totalYeast) < parseFloat(bigaYeast),
                        yeastWasClamped
                    }
                };
            } else {
                ingredients = {
                    flour: totalFlour,
                    water: Math.round(totalFlour * (hydration / 100)),
                    salt: Math.round(totalFlour * (styleConfig.salt / 100)),
                    yeast: totalYeast,
                    ...(styleConfig.diastatic && { diastatic: (totalFlour * styleConfig.diastatic / 100).toFixed(1) }),
                    ...(styleConfig.oil && { oil: Math.round(totalFlour * styleConfig.oil / 100) }),
                    ...(styleConfig.sugar && { sugar: Math.round(totalFlour * styleConfig.sugar / 100) })
                };
            }

            const flourBasis = (styleConfig.fermentMethod === 'biga' ? ingredients.totals.flour : ingredients.flour);
            const flourBlend = styleConfig.flourBlend.map(item => ({
                ...item,
                flourData: FLOUR_DATABASE[item.flourId],
                grams: Math.round(flourBasis * (item.percentage / 100))
            }));

            const warnings = [];
            if (hydration > 90) warnings.push('‚ö†Ô∏è Very high hydration (>90%) - expert level');
            if (hydration < 55) warnings.push('‚ö†Ô∏è Low hydration (<55%) - consider increasing');
            if (waterTemp < 5) warnings.push('‚ö†Ô∏è Water temp too low - use ice water');
            if (waterTemp > 45) warnings.push('‚ö†Ô∏è Water temp too high - may kill yeast');

            const saveRecipe = () => {
                if (!recipeName.trim()) {
                    alert('Please enter a recipe name');
                    return;
                }

                const recipe = {
                    name: recipeName,
                    pizzaStyle,
                    numPizzas,
                    doughBallWeight,
                    roomTemp,
                    flourTemp,
                    fridgeTemp,
                    desiredFDT,
                    mixerType,
                    yeastType,
                    ovenType,
                    customHydration,
                    bigaTemp,
                    bulkTemp,
                    proofTemp,
                    customBigaHours,
                    customBulkHours,
                    customColdHours,
                    customProofHours,
                    customBigaPercent,
                    customBigaHydration,
                    customBigaYeastPercent,
                    timestamp: new Date().toISOString()
                };

                const updated = [...savedRecipes, recipe];
                setSavedRecipes(updated);
                localStorage.setItem('pizzaRecipes', JSON.stringify(updated));
                setRecipeName('');
                alert('Recipe saved!');
            };

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>üçï Pizza Dough Calculator</h1>
                        <p>Professional recipe builder with temperature calculations</p>
                    </div>

                    <div className="tabs">
                        {[
                            ['setup', 'Setup'],
                            ['flour', 'Flour'],
                            ['fermentation', 'Fermentation'],
                            ['temps', 'Temperatures'],
                            ['recipe', 'Recipe'],
                            ['timeline', 'Timeline'],
                            ['save', 'Save']
                        ].map(([k, label]) => (
                            <button
                                key={k}
                                className={`tab-btn ${activeTab === k ? 'active' : ''}`}
                                onClick={() => switchTab(k)}
                                type="button"
                            >
                                {label}
                            </button>
                        ))}
                    </div>

                    <div className="calculator-grid">
                        <div>
                            {/* Setup Tab */}
                            {activeTab === 'setup' && (
                                <>
                                    <div className="card">
                                        <h2 className="card-title">Pizza Style</h2>
                                        <div className="style-selector">
                                            {Object.entries(PIZZA_STYLES).map(([key, style]) => (
                                                <button
                                                    key={key}
                                                    className={`style-button ${pizzaStyle === key ? 'active' : ''}`}
                                                    onClick={() => setPizzaStyle(key)}
                                                >
                                                    {style.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="card" style={{marginTop: '2rem'}}>
                                        <h2 className="card-title">Quantity</h2>
                                        <div className="input-row">
                                            <div className="input-group">
                                                <label className="input-label">Number of Pizzas</label>
                                                <input
                                                    type="number"
                                                    className="input-field"
                                                    value={numPizzas}
                                                    onChange={(e) => setNumPizzas(parseInt(e.target.value) || 1)}
                                                    min="1"
                                                    max="20"
                                                />
                                            </div>
                                            <div className="input-group">
                                                <label className="input-label">Dough Ball Weight (grams)</label>
                                                <input
                                                    type="number"
                                                    className="input-field"
                                                    value={doughBallWeight}
                                                    onChange={(e) => setDoughBallWeight(parseInt(e.target.value) || 280)}
                                                    min="100"
                                                    max="1000"
                                                    step="10"
                                                />
                                                <small style={{fontSize: '0.8rem', color: 'var(--crust)', marginTop: '0.5rem', display: 'block'}}>
                                                    Reference: 10"‚âà220g | 12"‚âà280g | 14"‚âà350g | 16"‚âà420g | 18"‚âà520g
                                                </small>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="card" style={{marginTop: '2rem'}}>
                                        <h2 className="card-title">Hydration</h2>
                                        <div className="input-group">
                                            <label className="input-label">Custom Hydration % (optional)</label>
                                            <input
                                                type="number"
                                                className="input-field"
                                                placeholder={`Default: ${styleConfig.hydration}%`}
                                                value={customHydration || ''}
                                                onChange={(e) => setCustomHydration(e.target.value ? parseFloat(e.target.value) : null)}
                                                step="0.5"
                                            />
                                        </div>

                                        <div className="hydration-indicator">
                                            <div style={{fontSize: '0.875rem', fontWeight: '500', marginBottom: '0.25rem'}}>
                                                Hydration Level: {hydration}%
                                            </div>
                                            <div className="hydration-bar">
                                                <div className="hydration-fill" style={{width: `${Math.min(hydration, 100)}%`}}>
                                                    {hydration}%
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}

                            {/* Fermentation Tab */}
                            {activeTab === 'fermentation' && (
                                <>
                                    <div className="card">
                                        <h2 className="card-title">Yeast Type</h2>
                                        <div className="input-group">
                                            <label className="input-label">Select Yeast Type</label>
                                            <select
                                                className="select-field"
                                                value={yeastType}
                                                onChange={(e) => setYeastType(e.target.value)}
                                            >
                                                <option value="instant">Instant Dry Yeast (IDY) - Standard</option>
                                                <option value="active-dry">Active Dry Yeast (ADY) - 25% more needed</option>
                                                <option value="fresh">Fresh Yeast (Cake) - 3√ó more needed</option>
                                                <option value="lemady">Lemady Yeast - Premium instant</option>
                                            </select>
                                        </div>
                                        <div className="info-box" style={{marginTop: '1rem'}}>
                                            <strong>üìä Yeast Calculation:</strong><br/>
                                            Base ({yeastCalc.totalHours.toFixed(1)}h): {(yeastCalc.baseYeast * 100).toFixed(2)}%<br/>
                                            Temp factor: √ó{yeastCalc.tempFactor.toFixed(2)}<br/>
                                            = <strong>{(yeastPercentage * 100).toFixed(3)}% {yeastType} = {totalYeast}g</strong>
                                        </div>
                                    </div>

                                    {styleConfig.fermentMethod === 'biga' && (
                                        <div className="card" style={{marginTop: '2rem'}}>
                                            <h2 className="card-title">Biga Settings</h2>
                                            <div className="input-row">
                                                <div className="input-group">
                                                    <label className="input-label">Biga % of flour</label>
                                                    <input
                                                        type="number"
                                                        className="input-field"
                                                        value={customBigaPercent ?? ''}
                                                        placeholder={`Default: ${styleConfig.bigaPercentage}%`}
                                                        onChange={(e) => setCustomBigaPercent(e.target.value ? parseFloat(e.target.value) : null)}
                                                        min="10"
                                                        max="90"
                                                    />
                                                </div>
                                                <div className="input-group">
                                                    <label className="input-label">Biga hydration %</label>
                                                    <input
                                                        type="number"
                                                        className="input-field"
                                                        value={customBigaHydration ?? ''}
                                                        placeholder={`Default: ${styleConfig.bigaHydration}%`}
                                                        onChange={(e) => setCustomBigaHydration(e.target.value ? parseFloat(e.target.value) : null)}
                                                        min="45"
                                                        max="80"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </>
                            )}

                            {/* Temperatures Tab */}
                            {activeTab === 'temps' && (
                                <>
                                    <div className="card">
                                        <h2 className="card-title">Temperatures</h2>
                                        <div className="input-group">
                                            <label className="input-label">Room Temperature (¬∞C)</label>
                                            <input
                                                type="number"
                                                className="input-field"
                                                value={roomTemp}
                                                onChange={(e) => setRoomTemp(parseFloat(e.target.value) || 20)}
                                                step="0.5"
                                            />
                                        </div>
                                        <div className="input-group">
                                            <label className="input-label">Flour Temperature (¬∞C)</label>
                                            <input
                                                type="number"
                                                className="input-field"
                                                value={flourTemp}
                                                onChange={(e) => setFlourTemp(parseFloat(e.target.value) || 20)}
                                                step="0.5"
                                            />
                                        </div>
                                        <div className="input-group">
                                            <label className="input-label">Desired Final Dough Temp (¬∞C)</label>
                                            <input
                                                type="number"
                                                className="input-field"
                                                value={desiredFDT}
                                                onChange={(e) => setDesiredFDT(parseFloat(e.target.value) || 24)}
                                                step="0.5"
                                            />
                                        </div>
                                    </div>

                                    <div className="card" style={{marginTop: '2rem'}}>
                                        <h2 className="card-title">Mixing Method</h2>
                                        <div className="input-group">
                                            <label className="input-label">Mixer Type</label>
                                            <select
                                                className="select-field"
                                                value={mixerType}
                                                onChange={(e) => setMixerType(e.target.value)}
                                            >
                                                <option value="no-knead">No-Knead (0¬∞C friction)</option>
                                                <option value="hand">Hand Mixing (6¬∞C)</option>
                                                <option value="low">Stand Mixer - Low (14¬∞C)</option>
                                                <option value="medium">Stand Mixer - Medium (22¬∞C)</option>
                                                <option value="spiral-low">Spiral Mixer - Low (18¬∞C)</option>
                                                <option value="spiral-high">Spiral Mixer - High (22¬∞C)</option>
                                                <option value="medium-high">Stand Mixer - Medium-High (26¬∞C)</option>
                                                <option value="high">Stand Mixer - High (28¬∞C)</option>
                                            </select>
                                        </div>
                                        <div className="info-box">
                                            <strong>Water Temperature Needed:</strong> {waterTemp}¬∞C
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>

                        {/* Right Column */}
                        <div>
                            {/* Recipe Tab */}
                            {activeTab === 'recipe' && (
                                <>
                                    {warnings.length > 0 && (
                                        <div className="card" style={{marginBottom: '2rem'}}>
                                            <h2 className="card-title">Warnings</h2>
                                            {warnings.map((warning, i) => (
                                                <div key={i} className="warning-box">{warning}</div>
                                            ))}
                                        </div>
                                    )}

                                    <div className="card">
                                        <h2 className="card-title">Recipe</h2>
                                        <div className="toggle-switch">
                                            <span>Grams</span>
                                            <label className="switch">
                                                <input
                                                    type="checkbox"
                                                    checked={showBakersPercentage}
                                                    onChange={(e) => setShowBakersPercentage(e.target.checked)}
                                                />
                                                <span className="slider"></span>
                                            </label>
                                            <span>Baker's %</span>
                                        </div>

                                        <div className="results-section">
                                            <div className="results-title">Flour Blend</div>
                                            <div className="flour-blend">
                                                {flourBlend.map((flour, i) => (
                                                    <div key={i} className="flour-item">
                                                        <div>
                                                            <div className="ingredient-name">{flour.flourData.name}</div>
                                                            <div style={{fontSize: '0.75rem', color: 'var(--crust)', marginTop: '0.25rem'}}>
                                                                {flour.flourData.protein}% protein, W{flour.flourData.w}
                                                            </div>
                                                        </div>
                                                        <div className="ingredient-amount">
                                                            {showBakersPercentage ? `${flour.percentage}%` : `${flour.grams}g`}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {styleConfig.fermentMethod === 'biga' ? (
                                            <>
                                                <div className="results-section">
                                                    <div className="results-title">Biga</div>
                                                    <div className="ingredient-list">
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Flour</span>
                                                            <span className="ingredient-amount">{ingredients.biga.flour}g</span>
                                                        </div>
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Water</span>
                                                            <span className="ingredient-amount">{ingredients.biga.water}g</span>
                                                        </div>
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Yeast</span>
                                                            <span className="ingredient-amount">{ingredients.biga.yeast}g</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="results-section">
                                                    <div className="results-title">Final Dough</div>
                                                    <div className="ingredient-list">
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Flour</span>
                                                            <span className="ingredient-amount">{ingredients.final.flour}g</span>
                                                        </div>
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Water ({waterTemp}¬∞C)</span>
                                                            <span className="ingredient-amount">{ingredients.final.water}g</span>
                                                        </div>
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Salt</span>
                                                            <span className="ingredient-amount">{ingredients.final.salt}g</span>
                                                        </div>
                                                        <div className="ingredient-item">
                                                            <span className="ingredient-name">Yeast</span>
                                                            <span className="ingredient-amount">{ingredients.final.yeast}g</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </>
                                        ) : (
                                            <div className="results-section">
                                                <div className="results-title">Ingredients</div>
                                                <div className="ingredient-list">
                                                    <div className="ingredient-item">
                                                        <span className="ingredient-name">Flour</span>
                                                        <span className="ingredient-amount">{ingredients.flour}g</span>
                                                    </div>
                                                    <div className="ingredient-item">
                                                        <span className="ingredient-name">Water ({waterTemp}¬∞C)</span>
                                                        <span className="ingredient-amount">{ingredients.water}g</span>
                                                    </div>
                                                    <div className="ingredient-item">
                                                        <span className="ingredient-name">Salt</span>
                                                        <span className="ingredient-amount">{ingredients.salt}g</span>
                                                    </div>
                                                    <div className="ingredient-item">
                                                        <span className="ingredient-name">Yeast</span>
                                                        <span className="ingredient-amount">{ingredients.yeast}g</span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </>
                            )}

                            {/* Save Tab */}
                            {activeTab === 'save' && (
                                <div className="card">
                                    <h2 className="card-title">Save Recipe</h2>
                                    <div className="recipe-name-input">
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Enter recipe name..."
                                            value={recipeName}
                                            onChange={(e) => setRecipeName(e.target.value)}
                                        />
                                    </div>
                                    <button className="button button-primary" onClick={saveRecipe} style={{width: '100%'}}>
                                        Save Recipe
                                    </button>
                                </div>
                            )}

                            {/* Placeholder for other tabs */}
                            {(activeTab === 'setup' || activeTab === 'fermentation' || activeTab === 'temps') && (
                                <div className="card">
                                    <h2 className="card-title">Quick Summary</h2>
                                    <div className="info-box">
                                        <strong>{numPizzas} pizzas √ó {doughBallWeight}g</strong><br/>
                                        {styleConfig.name} ‚Ä¢ {hydration}% hydration<br/>
                                        Total flour: {totalFlour}g<br/>
                                        Water temp: {waterTemp}¬∞C
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const mountApp = () => {
            const container = document.getElementById('root');
            if (!container) return;
            try {
                container.dataset.hasApp = '1';
                if (window.ReactDOM && typeof ReactDOM.render === 'function') {
                    ReactDOM.render(<PizzaCalculator />, container);
                } else {
                    throw new Error('ReactDOM.render not found');
                }
            } catch (err) {
                container.innerHTML = '';
                const pre = document.createElement('pre');
                pre.style.whiteSpace = 'pre-wrap';
                pre.style.padding = '16px';
                pre.style.margin = '16px auto';
                pre.style.maxWidth = '900px';
                pre.style.background = 'rgba(255,255,255,0.8)';
                pre.style.border = '1px solid rgba(0,0,0,0.1)';
                pre.style.borderRadius = '12px';
                pre.textContent = 'App failed to start\n\n' + (err && err.stack ? err.stack : String(err));
                container.appendChild(pre);
            }
        };

        setTimeout(mountApp, 0);

    </script>
</body>
</html>
