<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Pizza Dough Calculator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #B85C38;
            --primary-dark: #963d1f;
            --primary-light: #d67951;
            --secondary: #4A5859;
            --accent: #E3B04B;
            --flour: #F5E6D3;
            --wheat: #E8D4B8;
            --char: #2C2416;
            --char-light: #4A3C2E;
            --success: #52A447;
            --warning: #E8A647;
            --danger: #D84848;
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, var(--flour) 0%, var(--wheat) 100%);
            min-height: 100vh;
            color: var(--char);
            padding: 1rem;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            animation: fadeInDown 0.6s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.1rem;
            color: var(--char-light);
            font-weight: 400;
        }

        .tab-navigation {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--char);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Work Sans', sans-serif;
        }

        .tab-button:hover {
            background: var(--primary-light);
            color: white;
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(184, 92, 56, 0.3);
        }

        .content-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 968px) {
            .content-area {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            animation: fadeIn 0.4s ease-out;
        }

        .card h2 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
        }

        .card h3 {
            font-size: 1.2rem;
            color: var(--secondary);
            margin: 1rem 0 0.5rem 0;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--char-light);
            font-weight: 500;
            font-size: 0.95rem;
        }

        input[type="number"],
        input[type="text"],
        input[type="date"],
        input[type="time"],
        select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Work Sans', sans-serif;
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(184, 92, 56, 0.1);
        }

        button {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Work Sans', sans-serif;
        }

        button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(184, 92, 56, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--secondary);
        }

        button.secondary:hover {
            background: #3a4647;
        }

        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .info-box p {
            margin: 0.5rem 0;
            color: var(--char);
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-left: 4px solid var(--success);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .timeline-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .timeline-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .ingredient-item:nth-child(even) {
            background: #f9f9f9;
        }

        .flour-blend-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--accent);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .button-group button {
            flex: 1;
        }

        .small-text {
            font-size: 0.85rem;
            color: var(--char-light);
            font-style: italic;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // FLOUR DATABASE - User's exact 4 flours
        const FLOUR_DATABASE = [
            {
                id: 'casillo_la8',
                name: 'Casillo La 8 Plus Tipo 0',
                protein: 14.1,
                w_index: 350,
                pl_ratio: 0.60,
                absorption: 62,
                type: 'tipo0'
            },
            {
                id: 'casillo_superiore',
                name: 'Casillo Pizza Superiore Tipo 0',
                protein: 13.5,
                w_index: 340,
                pl_ratio: 0.55,
                absorption: 60,
                type: 'tipo0'
            },
            {
                id: 'casillo_aroma',
                name: 'Casillo Aroma Type 1',
                protein: 13.0,
                w_index: 280,
                pl_ratio: 0.75,
                absorption: 58,
                type: 'type1'
            },
            {
                id: 'caputo_blue',
                name: 'Caputo 00 Blue',
                protein: 12.5,
                w_index: 270,
                pl_ratio: 0.55,
                absorption: 55,
                type: '00'
            }
        ];

        // PIZZA STYLE PRESETS
        const PIZZA_STYLES = {
            daniel_gigi: {
                name: 'Daniel Gigi Style',
                hydration: 87.5,
                bigaPercent: 100,
                bigaHydration: 60,
                saltPercent: 3.0,
                finalDoughTemp: 24,
                bulkFermentHours: 24,
                coldFermentHours: 24,
                defaultFlours: ['casillo_la8'],
                fermentationNotes: '24h room temp + 24h cold'
            },
            contemporary: {
                name: 'Contemporary Pizza',
                hydration: 70,
                bigaPercent: 30,
                bigaHydration: 50,
                saltPercent: 2.5,
                finalDoughTemp: 24,
                bulkFermentHours: 4,
                coldFermentHours: 72,
                defaultFlours: ['casillo_superiore'],
                fermentationNotes: '4h room + 72h cold'
            },
            neapolitan: {
                name: 'Neapolitan',
                hydration: 62,
                bigaPercent: 0,
                bigaHydration: 50,
                saltPercent: 2.8,
                finalDoughTemp: 26,
                bulkFermentHours: 8,
                coldFermentHours: 0,
                defaultFlours: ['caputo_blue'],
                fermentationNotes: '8h room temp'
            },
            ny_style: {
                name: 'New York Style',
                hydration: 65,
                bigaPercent: 20,
                bigaHydration: 55,
                saltPercent: 2.2,
                finalDoughTemp: 24,
                bulkFermentHours: 2,
                coldFermentHours: 48,
                defaultFlours: ['casillo_superiore'],
                fermentationNotes: '2h room + 48h cold'
            },
            roman: {
                name: 'Roman Style',
                hydration: 80,
                bigaPercent: 40,
                bigaHydration: 50,
                saltPercent: 2.5,
                finalDoughTemp: 24,
                bulkFermentHours: 6,
                coldFermentHours: 48,
                defaultFlours: ['casillo_la8', 'casillo_aroma'],
                fermentationNotes: '6h room + 48h cold'
            },
            detroit: {
                name: 'Detroit Style',
                hydration: 75,
                bigaPercent: 0,
                bigaHydration: 50,
                saltPercent: 2.3,
                finalDoughTemp: 25,
                bulkFermentHours: 4,
                coldFermentHours: 24,
                defaultFlours: ['casillo_superiore'],
                fermentationNotes: '4h room + 24h cold'
            }
        };

        function PizzaCalculator() {
            // STATE MANAGEMENT
            const [activeTab, setActiveTab] = useState('setup');
            const [pizzaStyle, setPizzaStyle] = useState('daniel_gigi');
            const [numPizzas, setNumPizzas] = useState(4);
            const [doughBallWeight, setDoughBallWeight] = useState(2600);
            
            // Flour blend
            const [autoFlourBlend, setAutoFlourBlend] = useState(true);
            const [doughPriority, setDoughPriority] = useState('balanced');
            const [flourBlend, setFlourBlend] = useState([
                { flourId: 'casillo_la8', percentage: 100 }
            ]);
            
            // Fermentation
            const [yeastType, setYeastType] = useState('instant');
            const [customBigaPercent, setCustomBigaPercent] = useState('');
            const [customBigaHydration, setCustomBigaHydration] = useState('');
            const [customBulkHours, setCustomBulkHours] = useState('');
            const [customColdHours, setCustomColdHours] = useState('');
            const [bulkFermentTemp, setBulkFermentTemp] = useState(20);
            const [coldFermentTemp, setColdFermentTemp] = useState(4);
            
            // Temperatures
            const [mixerType, setMixerType] = useState('spiral_high');
            const [roomTemp, setRoomTemp] = useState(20);
            const [flourTemp, setFlourTemp] = useState(20);
            
            // Timeline mode
            const [timelineMode, setTimelineMode] = useState('forward');
            const [targetBakeDate, setTargetBakeDate] = useState('');
            const [targetBakeTime, setTargetBakeTime] = useState('18:00');

            // Get current style config
            const currentStyle = PIZZA_STYLES[pizzaStyle];

            // CALCULATION FUNCTIONS
            
            const getTotalFlour = () => {
                return numPizzas * doughBallWeight;
            };

            const getBigaPercent = () => {
                return customBigaPercent !== '' ? parseFloat(customBigaPercent) : currentStyle.bigaPercent;
            };

            const getBigaHydration = () => {
                return customBigaHydration !== '' ? parseFloat(customBigaHydration) : currentStyle.bigaHydration;
            };

            const getBulkHours = () => {
                return customBulkHours !== '' ? parseFloat(customBulkHours) : currentStyle.bulkFermentHours;
            };

            const getColdHours = () => {
                return customColdHours !== '' ? parseFloat(customColdHours) : currentStyle.coldFermentHours;
            };

            const getBigaFlour = () => {
                const totalFlour = getTotalFlour();
                return Math.round(totalFlour * (getBigaPercent() / 100));
            };

            const getBigaWater = () => {
                return Math.round(getBigaFlour() * (getBigaHydration() / 100));
            };

            const getMainDoughFlour = () => {
                return getTotalFlour() - getBigaFlour();
            };

            const getTotalWater = () => {
                const totalFlour = getTotalFlour();
                return Math.round(totalFlour * (currentStyle.hydration / 100));
            };

            const getMainDoughWater = () => {
                return getTotalWater() - getBigaWater();
            };

            const getSalt = () => {
                const totalFlour = getTotalFlour();
                return Math.round(totalFlour * (currentStyle.saltPercent / 100));
            };

            // YEAST CALCULATION - Enhanced with all factors
            const calculateYeast = () => {
                const totalFlour = getTotalFlour();
                const bulkHours = getBulkHours();
                const coldHours = getColdHours();
                
                // Base yeast calculation using Q10=2 rule
                // Reference: 24h at 20¬∞C = 0.2% instant yeast
                
                // Calculate effective fermentation time at 20¬∞C reference
                const bulkTempFactor = Math.pow(2, (bulkFermentTemp - 20) / 10);
                const coldTempFactor = Math.pow(2, (coldFermentTemp - 20) / 10);
                
                const effectiveBulkHours = bulkHours * bulkTempFactor;
                const effectiveColdHours = coldHours * coldTempFactor;
                const totalEffectiveHours = effectiveBulkHours + effectiveColdHours;
                
                // Base yeast for 24h at 20¬∞C
                let yeastPercent = 0.2;
                
                // Adjust for time
                if (totalEffectiveHours > 0) {
                    yeastPercent = (24 / totalEffectiveHours) * 0.2;
                }
                
                // Salt inhibition factor (salt slows fermentation)
                const saltFactor = 1 + (currentStyle.saltPercent / 100) * 0.3;
                yeastPercent *= saltFactor;
                
                // Hydration factor (higher hydration = faster fermentation)
                const hydrationFactor = 1 - ((currentStyle.hydration - 65) / 100) * 0.15;
                yeastPercent *= hydrationFactor;
                
                // Biga factor (pre-ferment reduces main dough yeast need)
                if (getBigaPercent() > 0) {
                    const bigaFactor = 1 - (getBigaPercent() / 100) * 0.3;
                    yeastPercent *= bigaFactor;
                }
                
                // Ensure reasonable bounds
                yeastPercent = Math.max(0.05, Math.min(2.0, yeastPercent));
                
                // Convert to grams
                const instantYeastGrams = Math.round(totalFlour * (yeastPercent / 100) * 10) / 10;
                
                // Convert to other yeast types
                const conversions = {
                    instant: instantYeastGrams,
                    'active-dry': Math.round(instantYeastGrams * 1.25 * 10) / 10,
                    fresh: Math.round(instantYeastGrams * 3.0 * 10) / 10,
                    lemady: Math.round(instantYeastGrams * 1.0 * 10) / 10
                };
                
                return {
                    grams: conversions[yeastType],
                    percent: Math.round(yeastPercent * 100) / 100,
                    factors: {
                        timeAdj: Math.round((24 / totalEffectiveHours) * 100) / 100,
                        saltAdj: Math.round(saltFactor * 100) / 100,
                        hydrationAdj: Math.round(hydrationFactor * 100) / 100,
                        bigaAdj: getBigaPercent() > 0 ? Math.round((1 - (getBigaPercent() / 100) * 0.3) * 100) / 100 : 1.0
                    }
                };
            };

            // Biga yeast (minimal)
            const getBigaYeast = () => {
                if (getBigaPercent() === 0) return 0;
                const bigaFlour = getBigaFlour();
                // Very small amount - biga ferments slowly
                return Math.round(bigaFlour * 0.001 * 10) / 10;
            };

            // Main dough yeast
            const getMainDoughYeast = () => {
                const total = calculateYeast().grams;
                const bigaYeast = getBigaYeast();
                return Math.round((total - bigaYeast) * 10) / 10;
            };

            // WATER TEMPERATURE CALCULATION
            const getFrictionFactor = () => {
                const mixerFactors = {
                    'hand': 0,
                    'stand_low': 10,
                    'stand_high': 15,
                    'spiral_low': 20,
                    'spiral_high': 22
                };
                return mixerFactors[mixerType] || 0;
            };

            const getWaterTemp = () => {
                const fdt = currentStyle.finalDoughTemp;
                const friction = getFrictionFactor();
                
                // Formula: Water Temp = (FDT √ó 4) - flour temp - room temp - friction
                const waterTemp = (fdt * 4) - flourTemp - roomTemp - friction;
                
                return Math.round(waterTemp);
            };

            // FLOUR BLEND RECOMMENDATION
            const recommendFlourBlend = () => {
                if (!autoFlourBlend) return flourBlend;
                
                const priorities = {
                    balanced: { w_weight: 0.33, pl_weight: 0.33, protein_weight: 0.34 },
                    extensible: { w_weight: 0.2, pl_weight: 0.5, protein_weight: 0.3 },
                    strength: { w_weight: 0.5, pl_weight: 0.2, protein_weight: 0.3 }
                };
                
                const priority = priorities[doughPriority];
                
                // Target values based on pizza style
                const targets = {
                    w_index: 300,
                    pl_ratio: 0.60,
                    protein: 13.0
                };
                
                // Score each flour
                const scoredFlours = FLOUR_DATABASE.map(flour => {
                    const wScore = 1 - Math.abs(flour.w_index - targets.w_index) / targets.w_index;
                    const plScore = 1 - Math.abs(flour.pl_ratio - targets.pl_ratio) / targets.pl_ratio;
                    const proteinScore = 1 - Math.abs(flour.protein - targets.protein) / targets.protein;
                    
                    const totalScore = (wScore * priority.w_weight) + 
                                      (plScore * priority.pl_weight) + 
                                      (proteinScore * priority.protein_weight);
                    
                    return { ...flour, score: totalScore };
                });
                
                // Sort by score
                scoredFlours.sort((a, b) => b.score - a.score);
                
                // Return top flour as 100%
                return [{ flourId: scoredFlours[0].id, percentage: 100 }];
            };

            // Update flour blend when auto mode changes
            useEffect(() => {
                if (autoFlourBlend) {
                    setFlourBlend(recommendFlourBlend());
                }
            }, [autoFlourBlend, doughPriority, pizzaStyle]);

            // TIMELINE GENERATION
            const generateTimeline = () => {
                const timeline = [];
                const now = new Date();
                
                if (timelineMode === 'forward') {
                    // Forward timeline - starting now
                    
                    // Biga preparation
                    if (getBigaPercent() > 0) {
                        timeline.push({
                            time: formatDateTime(now),
                            action: 'Prepare Biga',
                            detail: `Mix ${getBigaFlour()}g flour + ${getBigaWater()}g water + ${getBigaYeast()}g yeast`,
                            temperature: `Let ferment at room temp (${roomTemp}¬∞C)`
                        });
                        
                        // Biga ready time (16-24 hours)
                        const bigaReady = new Date(now.getTime() + 18 * 60 * 60 * 1000);
                        timeline.push({
                            time: formatDateTime(bigaReady),
                            action: 'Biga Ready',
                            detail: 'Biga should be bubbly and expanded',
                            temperature: null
                        });
                    }
                    
                    // Main mix time
                    const mixTime = getBigaPercent() > 0 ? 
                        new Date(now.getTime() + 18 * 60 * 60 * 1000) : 
                        now;
                    
                    timeline.push({
                        time: formatDateTime(mixTime),
                        action: 'Mix Main Dough',
                        detail: `Use ${getWaterTemp()}¬∞C water. Mix all ingredients.`,
                        temperature: `Target final dough temp: ${currentStyle.finalDoughTemp}¬∞C`
                    });
                    
                    // Bulk fermentation
                    const bulkEnd = new Date(mixTime.getTime() + getBulkHours() * 60 * 60 * 1000);
                    timeline.push({
                        time: formatDateTime(bulkEnd),
                        action: 'Ball Dough',
                        detail: `Divide into ${numPizzas} √ó ${doughBallWeight}g balls`,
                        temperature: `Bulk ferment at ${bulkFermentTemp}¬∞C`
                    });
                    
                    // Cold fermentation (if any)
                    if (getColdHours() > 0) {
                        const coldEnd = new Date(bulkEnd.getTime() + getColdHours() * 60 * 60 * 1000);
                        timeline.push({
                            time: formatDateTime(coldEnd),
                            action: 'Ready to Bake',
                            detail: 'Remove from fridge 1-2 hours before baking',
                            temperature: `Cold ferment at ${coldFermentTemp}¬∞C`
                        });
                    } else {
                        timeline.push({
                            time: formatDateTime(bulkEnd),
                            action: 'Ready to Bake',
                            detail: 'Dough is ready after balling',
                            temperature: null
                        });
                    }
                    
                } else {
                    // Reverse timeline - work backwards from bake time
                    if (!targetBakeDate || !targetBakeTime) {
                        return [{
                            time: 'Please set target bake date and time',
                            action: 'Configuration Required',
                            detail: 'Use the inputs above to set your target bake time',
                            temperature: null
                        }];
                    }
                    
                    const bakeDateTime = new Date(`${targetBakeDate}T${targetBakeTime}`);
                    
                    timeline.push({
                        time: formatDateTime(bakeDateTime),
                        action: 'BAKE TIME',
                        detail: 'Your pizzas are ready to bake!',
                        temperature: 'üî•'
                    });
                    
                    // Work backwards
                    // Remove from fridge 2 hours before
                    const removeFromFridge = new Date(bakeDateTime.getTime() - 2 * 60 * 60 * 1000);
                    
                    if (getColdHours() > 0) {
                        timeline.push({
                            time: formatDateTime(removeFromFridge),
                            action: 'Remove from Fridge',
                            detail: 'Let dough warm up to room temp',
                            temperature: null
                        });
                        
                        // Start of cold ferment
                        const coldStart = new Date(removeFromFridge.getTime() - getColdHours() * 60 * 60 * 1000);
                        timeline.push({
                            time: formatDateTime(coldStart),
                            action: 'Ball & Refrigerate',
                            detail: `Divide into ${numPizzas} √ó ${doughBallWeight}g balls, place in fridge`,
                            temperature: `${coldFermentTemp}¬∞C for ${getColdHours()}h`
                        });
                        
                        // Mix time (before cold ferment)
                        const mixTime = new Date(coldStart.getTime() - getBulkHours() * 60 * 60 * 1000);
                        timeline.push({
                            time: formatDateTime(mixTime),
                            action: 'Mix Main Dough',
                            detail: `Water temp: ${getWaterTemp()}¬∞C`,
                            temperature: `Bulk ferment at ${bulkFermentTemp}¬∞C for ${getBulkHours()}h`
                        });
                        
                        // Biga preparation
                        if (getBigaPercent() > 0) {
                            const bigaStart = new Date(mixTime.getTime() - 18 * 60 * 60 * 1000);
                            timeline.push({
                                time: formatDateTime(bigaStart),
                                action: 'START: Prepare Biga',
                                detail: `${getBigaFlour()}g flour + ${getBigaWater()}g water + ${getBigaYeast()}g yeast`,
                                temperature: `Room temp for ~18h`
                            });
                        } else {
                            timeline.push({
                                time: formatDateTime(mixTime),
                                action: 'START HERE',
                                detail: 'Begin your dough preparation at this time',
                                temperature: null
                            });
                        }
                    } else {
                        // No cold ferment - just bulk
                        const mixTime = new Date(bakeDateTime.getTime() - 2 * 60 * 60 * 1000 - getBulkHours() * 60 * 60 * 1000);
                        
                        timeline.push({
                            time: formatDateTime(mixTime),
                            action: 'Mix & Ball',
                            detail: `Mix dough, let rise ${getBulkHours()}h, then ball`,
                            temperature: `${bulkFermentTemp}¬∞C`
                        });
                        
                        if (getBigaPercent() > 0) {
                            const bigaStart = new Date(mixTime.getTime() - 18 * 60 * 60 * 1000);
                            timeline.push({
                                time: formatDateTime(bigaStart),
                                action: 'START: Prepare Biga',
                                detail: `${getBigaFlour()}g flour + ${getBigaWater()}g water + ${getBigaYeast()}g yeast`,
                                temperature: 'Room temp for ~18h'
                            });
                        } else {
                            timeline.push({
                                time: formatDateTime(mixTime),
                                action: 'START HERE',
                                detail: 'Begin your dough preparation',
                                temperature: null
                            });
                        }
                    }
                    
                    // Reverse the array so it shows chronologically
                    timeline.reverse();
                }
                
                return timeline;
            };

            const formatDateTime = (date) => {
                return date.toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            // DOUGH HEALTH ASSESSMENT
            const assessDoughHealth = () => {
                const issues = [];
                const warnings = [];
                
                // Check hydration vs flour strength
                const avgWIndex = flourBlend.reduce((sum, item) => {
                    const flour = FLOUR_DATABASE.find(f => f.id === item.flourId);
                    return sum + (flour.w_index * item.percentage / 100);
                }, 0);
                
                if (currentStyle.hydration > 75 && avgWIndex < 300) {
                    warnings.push('High hydration with moderate strength flour - dough may be slack');
                }
                
                if (currentStyle.hydration < 60 && avgWIndex > 320) {
                    warnings.push('Low hydration with strong flour - dough may be tight');
                }
                
                // Check fermentation time
                const totalHours = getBulkHours() + getColdHours();
                if (totalHours < 12) {
                    warnings.push('Short fermentation time - flavor development may be limited');
                }
                
                if (totalHours > 96) {
                    warnings.push('Very long fermentation - monitor for over-fermentation');
                }
                
                // Check yeast amount
                const yeastData = calculateYeast();
                if (yeastData.percent < 0.1) {
                    warnings.push('Very low yeast - ensure fermentation conditions are optimal');
                }
                
                if (yeastData.percent > 1.5) {
                    warnings.push('High yeast amount - fermentation will be very fast');
                }
                
                // Check salt
                if (currentStyle.saltPercent < 2.0) {
                    warnings.push('Low salt - dough may ferment too quickly');
                }
                
                if (currentStyle.saltPercent > 3.2) {
                    warnings.push('High salt - fermentation will be slowed significantly');
                }
                
                return { issues, warnings };
            };

            // SAVE/LOAD FUNCTIONS
            const saveRecipe = () => {
                const recipe = {
                    pizzaStyle,
                    numPizzas,
                    doughBallWeight,
                    flourBlend,
                    yeastType,
                    customBigaPercent,
                    customBigaHydration,
                    customBulkHours,
                    customColdHours,
                    bulkFermentTemp,
                    coldFermentTemp,
                    mixerType,
                    roomTemp,
                    flourTemp,
                    timestamp: new Date().toISOString()
                };
                
                const recipes = JSON.parse(localStorage.getItem('pizzaRecipes') || '[]');
                const recipeName = prompt('Enter a name for this recipe:');
                if (recipeName) {
                    recipe.name = recipeName;
                    recipes.push(recipe);
                    localStorage.setItem('pizzaRecipes', JSON.stringify(recipes));
                    alert('Recipe saved!');
                }
            };

            const loadRecipe = () => {
                const recipes = JSON.parse(localStorage.getItem('pizzaRecipes') || '[]');
                if (recipes.length === 0) {
                    alert('No saved recipes found');
                    return;
                }
                
                const recipeList = recipes.map((r, i) => `${i + 1}. ${r.name} (${new Date(r.timestamp).toLocaleDateString()})`).join('\n');
                const choice = prompt(`Select a recipe:\n${recipeList}\n\nEnter number:`);
                
                if (choice) {
                    const index = parseInt(choice) - 1;
                    if (index >= 0 && index < recipes.length) {
                        const recipe = recipes[index];
                        setPizzaStyle(recipe.pizzaStyle);
                        setNumPizzas(recipe.numPizzas);
                        setDoughBallWeight(recipe.doughBallWeight);
                        setFlourBlend(recipe.flourBlend);
                        setYeastType(recipe.yeastType);
                        setCustomBigaPercent(recipe.customBigaPercent);
                        setCustomBigaHydration(recipe.customBigaHydration);
                        setCustomBulkHours(recipe.customBulkHours);
                        setCustomColdHours(recipe.customColdHours);
                        setBulkFermentTemp(recipe.bulkFermentTemp);
                        setColdFermentTemp(recipe.coldFermentTemp);
                        setMixerType(recipe.mixerType);
                        setRoomTemp(recipe.roomTemp);
                        setFlourTemp(recipe.flourTemp);
                        alert('Recipe loaded!');
                    }
                }
            };

            const exportRecipe = () => {
                const yeastData = calculateYeast();
                const health = assessDoughHealth();
                
                let text = `=== PIZZA DOUGH RECIPE ===\n`;
                text += `Style: ${currentStyle.name}\n`;
                text += `${numPizzas} pizzas √ó ${doughBallWeight}g = ${getTotalFlour()}g total flour\n\n`;
                
                text += `=== INGREDIENTS ===\n`;
                text += `Total Flour: ${getTotalFlour()}g\n`;
                
                if (getBigaPercent() > 0) {
                    text += `\nBIGA (${getBigaPercent()}% of flour):\n`;
                    text += `  Flour: ${getBigaFlour()}g\n`;
                    text += `  Water (${getBigaHydration()}%): ${getBigaWater()}g\n`;
                    text += `  Yeast: ${getBigaYeast()}g ${yeastType}\n`;
                    text += `\nMAIN DOUGH:\n`;
                    text += `  Flour: ${getMainDoughFlour()}g\n`;
                    text += `  Water: ${getMainDoughWater()}g\n`;
                    text += `  Yeast: ${getMainDoughYeast()}g ${yeastType}\n`;
                } else {
                    text += `Water (${currentStyle.hydration}%): ${getTotalWater()}g\n`;
                    text += `Yeast (${yeastData.percent}%): ${yeastData.grams}g ${yeastType}\n`;
                }
                
                text += `Salt (${currentStyle.saltPercent}%): ${getSalt()}g\n\n`;
                
                text += `=== INSTRUCTIONS ===\n`;
                generateTimeline().forEach(step => {
                    text += `\n${step.time}\n`;
                    text += `${step.action}\n`;
                    text += `${step.detail}\n`;
                    if (step.temperature) text += `${step.temperature}\n`;
                });
                
                if (health.warnings.length > 0) {
                    text += `\n=== NOTES ===\n`;
                    health.warnings.forEach(w => text += `‚ö†Ô∏è  ${w}\n`);
                }
                
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `pizza-recipe-${Date.now()}.txt`;
                a.click();
            };

            // RENDER
            const health = assessDoughHealth();
            const yeastData = calculateYeast();

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>üçï Pizza Dough Calculator</h1>
                        <p>Professional recipe builder with temperature calculations</p>
                    </div>

                    <div className="tab-navigation">
                        <button 
                            className={`tab-button ${activeTab === 'setup' ? 'active' : ''}`}
                            onClick={() => setActiveTab('setup')}
                        >
                            Setup
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'flour' ? 'active' : ''}`}
                            onClick={() => setActiveTab('flour')}
                        >
                            Flour
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'fermentation' ? 'active' : ''}`}
                            onClick={() => setActiveTab('fermentation')}
                        >
                            Fermentation
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'temps' ? 'active' : ''}`}
                            onClick={() => setActiveTab('temps')}
                        >
                            Temperatures
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'recipe' ? 'active' : ''}`}
                            onClick={() => setActiveTab('recipe')}
                        >
                            Recipe
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'timeline' ? 'active' : ''}`}
                            onClick={() => setActiveTab('timeline')}
                        >
                            Timeline
                        </button>
                        <button 
                            className={`tab-button ${activeTab === 'save' ? 'active' : ''}`}
                            onClick={() => setActiveTab('save')}
                        >
                            Save
                        </button>
                    </div>

                    <div className="content-area">
                        {/* LEFT COLUMN */}
                        <div>
                            {activeTab === 'setup' && (
                                <>
                                    <div className="card">
                                        <h2>Pizza Style</h2>
                                        <div className="form-group">
                                            <label>Style Preset</label>
                                            <select value={pizzaStyle} onChange={(e) => setPizzaStyle(e.target.value)}>
                                                {Object.entries(PIZZA_STYLES).map(([key, style]) => (
                                                    <option key={key} value={key}>{style.name}</option>
                                                ))}
                                            </select>
                                            <p className="small-text" style={{marginTop: '0.5rem'}}>
                                                {currentStyle.fermentationNotes}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="card" style={{marginTop: '2rem'}}>
                                        <h2>Quantity</h2>
                                        <div className="form-group">
                                            <label>Number of Pizzas</label>
                                            <input 
                                                type="number" 
                                                value={numPizzas} 
                                                onChange={(e) => setNumPizzas(parseInt(e.target.value) || 1)}
                                                min="1"
                                                max="100"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Dough Ball Weight (grams)</label>
                                            <input 
                                                type="number" 
                                                value={doughBallWeight} 
                                                onChange={(e) => setDoughBallWeight(parseInt(e.target.value) || 250)}
                                                min="100"
                                                max="1000"
                                                step="50"
                                            />
                                            <p className="small-text" style={{marginTop: '0.5rem'}}>
                                                Typical: 250g (10"), 300g (12"), 550g (16")
                                            </p>
                                        </div>
                                        <div className="info-box">
                                            <p><strong>Total Flour Needed:</strong> {getTotalFlour()}g</p>
                                            <p><strong>Hydration:</strong> {currentStyle.hydration}%</p>
                                        </div>
                                    </div>
                                </>
                            )}

                            {activeTab === 'flour' && (
                                <div className="card">
                                    <h2>Flour Selection</h2>
                                    
                                    <div className="checkbox-group">
                                        <input 
                                            type="checkbox" 
                                            id="autoFlour"
                                            checked={autoFlourBlend}
                                            onChange={(e) => setAutoFlourBlend(e.target.checked)}
                                        />
                                        <label htmlFor="autoFlour">Auto-recommend flour blend</label>
                                    </div>

                                    {autoFlourBlend && (
                                        <div className="form-group">
                                            <label>Dough Priority</label>
                                            <select value={doughPriority} onChange={(e) => setDoughPriority(e.target.value)}>
                                                <option value="balanced">Balanced</option>
                                                <option value="extensible">Extensible (Easy to stretch)</option>
                                                <option value="strength">Strength (Holds shape)</option>
                                            </select>
                                        </div>
                                    )}

                                    <h3>Your Flour Blend</h3>
                                    {flourBlend.map((item, index) => {
                                        const flour = FLOUR_DATABASE.find(f => f.id === item.flourId);
                                        return (
                                            <div key={index} className="flour-blend-item">
                                                {autoFlourBlend ? (
                                                    <>
                                                        <strong>{flour.name}</strong>
                                                        <p className="small-text">
                                                            W: {flour.w_index} | P/L: {flour.pl_ratio} | Protein: {flour.protein}%
                                                        </p>
                                                        <p><strong>{item.percentage}%</strong> = {Math.round(getTotalFlour() * item.percentage / 100)}g</p>
                                                    </>
                                                ) : (
                                                    <>
                                                        <select 
                                                            value={item.flourId}
                                                            onChange={(e) => {
                                                                const newBlend = [...flourBlend];
                                                                newBlend[index].flourId = e.target.value;
                                                                setFlourBlend(newBlend);
                                                            }}
                                                        >
                                                            {FLOUR_DATABASE.map(f => (
                                                                <option key={f.id} value={f.id}>{f.name}</option>
                                                            ))}
                                                        </select>
                                                        <input 
                                                            type="number"
                                                            value={item.percentage}
                                                            onChange={(e) => {
                                                                const newBlend = [...flourBlend];
                                                                newBlend[index].percentage = parseInt(e.target.value) || 0;
                                                                setFlourBlend(newBlend);
                                                            }}
                                                            min="0"
                                                            max="100"
                                                            style={{width: '80px', marginTop: '0.5rem'}}
                                                        />
                                                        <span>% = {Math.round(getTotalFlour() * item.percentage / 100)}g</span>
                                                    </>
                                                )}
                                            </div>
                                        );
                                    })}

                                    {!autoFlourBlend && (
                                        <div className="button-group">
                                            <button onClick={() => setFlourBlend([...flourBlend, { flourId: 'casillo_la8', percentage: 0 }])}>
                                                Add Flour
                                            </button>
                                            {flourBlend.length > 1 && (
                                                <button 
                                                    className="secondary"
                                                    onClick={() => setFlourBlend(flourBlend.slice(0, -1))}
                                                >
                                                    Remove Last
                                                </button>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}

                            {activeTab === 'fermentation' && (
                                <div className="card">
                                    <h2>Fermentation Settings</h2>
                                    
                                    <div className="form-group">
                                        <label>Yeast Type</label>
                                        <select value={yeastType} onChange={(e) => setYeastType(e.target.value)}>
                                            <option value="instant">Instant Dry Yeast</option>
                                            <option value="active-dry">Active Dry Yeast</option>
                                            <option value="fresh">Fresh Yeast</option>
                                            <option value="lemady">Lemady Yeast</option>
                                        </select>
                                    </div>

                                    <h3>Biga Settings</h3>
                                    <div className="form-group">
                                        <label>Biga % of Total Flour</label>
                                        <input 
                                            type="number"
                                            value={customBigaPercent}
                                            onChange={(e) => setCustomBigaPercent(e.target.value)}
                                            placeholder={`Default: ${currentStyle.bigaPercent}%`}
                                            min="0"
                                            max="100"
                                        />
                                        <p className="small-text">Leave blank to use style default ({currentStyle.bigaPercent}%)</p>
                                    </div>

                                    <div className="form-group">
                                        <label>Biga Hydration %</label>
                                        <input 
                                            type="number"
                                            value={customBigaHydration}
                                            onChange={(e) => setCustomBigaHydration(e.target.value)}
                                            placeholder={`Default: ${currentStyle.bigaHydration}%`}
                                            min="40"
                                            max="100"
                                        />
                                        <p className="small-text">Leave blank to use style default ({currentStyle.bigaHydration}%)</p>
                                    </div>

                                    <h3>Fermentation Duration</h3>
                                    <div className="form-group">
                                        <label>Bulk Fermentation (hours)</label>
                                        <input 
                                            type="number"
                                            value={customBulkHours}
                                            onChange={(e) => setCustomBulkHours(e.target.value)}
                                            placeholder={`Default: ${currentStyle.bulkFermentHours}h`}
                                            min="0"
                                            max="48"
                                            step="0.5"
                                        />
                                        <p className="small-text">At {bulkFermentTemp}¬∞C (set in Temperatures tab)</p>
                                    </div>

                                    <div className="form-group">
                                        <label>Cold Fermentation (hours)</label>
                                        <input 
                                            type="number"
                                            value={customColdHours}
                                            onChange={(e) => setCustomColdHours(e.target.value)}
                                            placeholder={`Default: ${currentStyle.coldFermentHours}h`}
                                            min="0"
                                            max="120"
                                            step="0.5"
                                        />
                                        <p className="small-text">At {coldFermentTemp}¬∞C (set in Temperatures tab)</p>
                                    </div>

                                    <div className="info-box">
                                        <p><strong>Calculated Yeast:</strong> {yeastData.grams}g ({yeastData.percent}%)</p>
                                        <p className="small-text">
                                            Factors: Time√ó{yeastData.factors.timeAdj}, Salt√ó{yeastData.factors.saltAdj}, 
                                            Hydration√ó{yeastData.factors.hydrationAdj}, Biga√ó{yeastData.factors.bigaAdj}
                                        </p>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'temps' && (
                                <>
                                    <div className="card">
                                        <h2>Temperature Settings</h2>
                                        
                                        <div className="form-group">
                                            <label>Bulk Fermentation Temp (¬∞C)</label>
                                            <input 
                                                type="number"
                                                value={bulkFermentTemp}
                                                onChange={(e) => setBulkFermentTemp(parseInt(e.target.value) || 20)}
                                                min="15"
                                                max="30"
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label>Cold Fermentation Temp (¬∞C)</label>
                                            <input 
                                                type="number"
                                                value={coldFermentTemp}
                                                onChange={(e) => setColdFermentTemp(parseInt(e.target.value) || 4)}
                                                min="2"
                                                max="10"
                                            />
                                        </div>
                                    </div>

                                    <div className="card" style={{marginTop: '2rem'}}>
                                        <h2>Mixing Method</h2>
                                        
                                        <div className="form-group">
                                            <label>Mixer Type</label>
                                            <select value={mixerType} onChange={(e) => setMixerType(e.target.value)}>
                                                <option value="hand">Hand Mix</option>
                                                <option value="stand_low">Stand Mixer - Low Speed</option>
                                                <option value="stand_high">Stand Mixer - High Speed</option>
                                                <option value="spiral_low">Spiral Mixer - Low Speed</option>
                                                <option value="spiral_high">Spiral Mixer - High Speed</option>
                                            </select>
                                        </div>

                                        <div className="form-group">
                                            <label>Room Temperature (¬∞C)</label>
                                            <input 
                                                type="number"
                                                value={roomTemp}
                                                onChange={(e) => setRoomTemp(parseInt(e.target.value) || 20)}
                                                min="10"
                                                max="35"
                                            />
                                        </div>

                                        <div className="form-group">
                                            <label>Flour Temperature (¬∞C)</label>
                                            <input 
                                                type="number"
                                                value={flourTemp}
                                                onChange={(e) => setFlourTemp(parseInt(e.target.value) || 20)}
                                                min="10"
                                                max="30"
                                            />
                                        </div>

                                        <div className="info-box">
                                            <p><strong>Water Temperature Needed:</strong> {getWaterTemp()}¬∞C</p>
                                            <p className="small-text">
                                                Formula: (FDT √ó 4) - flour temp - room temp - friction factor
                                            </p>
                                            <p className="small-text">
                                                Target Final Dough Temp: {currentStyle.finalDoughTemp}¬∞C
                                            </p>
                                        </div>
                                    </div>
                                </>
                            )}

                            {activeTab === 'timeline' && (
                                <div className="card">
                                    <h2>Timeline Mode</h2>
                                    
                                    <div className="form-group">
                                        <label>Timeline Type</label>
                                        <select value={timelineMode} onChange={(e) => setTimelineMode(e.target.value)}>
                                            <option value="forward">Forward (Starting Now)</option>
                                            <option value="reverse">Reverse (From Bake Time)</option>
                                        </select>
                                    </div>

                                    {timelineMode === 'reverse' && (
                                        <>
                                            <div className="form-group">
                                                <label>Target Bake Date</label>
                                                <input 
                                                    type="date"
                                                    value={targetBakeDate}
                                                    onChange={(e) => setTargetBakeDate(e.target.value)}
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label>Target Bake Time</label>
                                                <input 
                                                    type="time"
                                                    value={targetBakeTime}
                                                    onChange={(e) => setTargetBakeTime(e.target.value)}
                                                />
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}

                            {activeTab === 'save' && (
                                <div className="card">
                                    <h2>Save & Export</h2>
                                    
                                    <div className="button-group" style={{flexDirection: 'column'}}>
                                        <button onClick={saveRecipe}>üíæ Save Recipe</button>
                                        <button onClick={loadRecipe} className="secondary">üìÇ Load Recipe</button>
                                        <button onClick={exportRecipe}>üìÑ Export to Text File</button>
                                    </div>

                                    <p className="small-text" style={{marginTop: '1rem'}}>
                                        Recipes are saved to your browser's local storage.
                                    </p>
                                </div>
                            )}
                        </div>

                        {/* RIGHT COLUMN */}
                        <div>
                            {(activeTab === 'setup' || activeTab === 'recipe') && (
                                <div className="card">
                                    <h2>Complete Recipe</h2>
                                    
                                    {getBigaPercent() > 0 && (
                                        <>
                                            <h3>BIGA ({getBigaPercent()}%)</h3>
                                            <div className="ingredient-item">
                                                <span>Flour</span>
                                                <strong>{getBigaFlour()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Water ({getBigaHydration()}%)</span>
                                                <strong>{getBigaWater()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Yeast ({yeastType})</span>
                                                <strong>{getBigaYeast()}g</strong>
                                            </div>
                                        </>
                                    )}

                                    <h3>{getBigaPercent() > 0 ? 'MAIN DOUGH' : 'INGREDIENTS'}</h3>
                                    {getBigaPercent() > 0 ? (
                                        <>
                                            <div className="ingredient-item">
                                                <span>Flour</span>
                                                <strong>{getMainDoughFlour()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Water</span>
                                                <strong>{getMainDoughWater()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Yeast ({yeastType})</span>
                                                <strong>{getMainDoughYeast()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Biga (from above)</span>
                                                <strong>All of it</strong>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <div className="ingredient-item">
                                                <span>Flour</span>
                                                <strong>{getTotalFlour()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Water ({currentStyle.hydration}%)</span>
                                                <strong>{getTotalWater()}g</strong>
                                            </div>
                                            <div className="ingredient-item">
                                                <span>Yeast ({yeastData.percent}%)</span>
                                                <strong>{yeastData.grams}g {yeastType}</strong>
                                            </div>
                                        </>
                                    )}
                                    <div className="ingredient-item">
                                        <span>Salt ({currentStyle.saltPercent}%)</span>
                                        <strong>{getSalt()}g</strong>
                                    </div>

                                    <h3>Quick Summary</h3>
                                    <div className="success-box">
                                        <p><strong>{numPizzas} pizzas √ó {doughBallWeight}g</strong></p>
                                        <p>{currentStyle.name} ‚Ä¢ {currentStyle.hydration}% hydration</p>
                                        <p>Total flour: {getTotalFlour()}g</p>
                                        <p>Water temp: {getWaterTemp()}¬∞C</p>
                                    </div>

                                    {health.warnings.length > 0 && (
                                        <>
                                            <h3>Recommendations</h3>
                                            {health.warnings.map((warning, i) => (
                                                <div key={i} className="warning-box">
                                                    <p>‚ö†Ô∏è  {warning}</p>
                                                </div>
                                            ))}
                                        </>
                                    )}
                                </div>
                            )}

                            {activeTab === 'flour' && (
                                <div className="card">
                                    <h2>Flour Database</h2>
                                    <p className="small-text">Your available flours</p>
                                    
                                    {FLOUR_DATABASE.map(flour => (
                                        <div key={flour.id} className="flour-blend-item" style={{marginTop: '1rem'}}>
                                            <strong>{flour.name}</strong>
                                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem', marginTop: '0.5rem'}}>
                                                <p className="small-text">W Index: {flour.w_index}</p>
                                                <p className="small-text">P/L Ratio: {flour.pl_ratio}</p>
                                                <p className="small-text">Protein: {flour.protein}%</p>
                                                <p className="small-text">Absorption: {flour.absorption}%</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'fermentation' && (
                                <div className="card">
                                    <h2>Fermentation Summary</h2>
                                    
                                    <div className="info-box">
                                        <p><strong>Total Fermentation Time:</strong> {getBulkHours() + getColdHours()} hours</p>
                                        <p>‚Ä¢ Bulk: {getBulkHours()}h at {bulkFermentTemp}¬∞C</p>
                                        <p>‚Ä¢ Cold: {getColdHours()}h at {coldFermentTemp}¬∞C</p>
                                    </div>

                                    <h3>Yeast Breakdown</h3>
                                    <div className="success-box">
                                        <p><strong>Total Yeast: {yeastData.grams}g ({yeastData.percent}%)</strong></p>
                                        {getBigaPercent() > 0 && (
                                            <>
                                                <p>‚Ä¢ Biga: {getBigaYeast()}g</p>
                                                <p>‚Ä¢ Main Dough: {getMainDoughYeast()}g</p>
                                            </>
                                        )}
                                    </div>

                                    <h3>Calculation Factors</h3>
                                    <div className="ingredient-item">
                                        <span>Time Adjustment</span>
                                        <strong>√ó{yeastData.factors.timeAdj}</strong>
                                    </div>
                                    <div className="ingredient-item">
                                        <span>Salt Factor</span>
                                        <strong>√ó{yeastData.factors.saltAdj}</strong>
                                    </div>
                                    <div className="ingredient-item">
                                        <span>Hydration Factor</span>
                                        <strong>√ó{yeastData.factors.hydrationAdj}</strong>
                                    </div>
                                    <div className="ingredient-item">
                                        <span>Biga Factor</span>
                                        <strong>√ó{yeastData.factors.bigaAdj}</strong>
                                    </div>

                                    <p className="small-text" style={{marginTop: '1rem'}}>
                                        Yeast calculation uses Q10=2 rule for temperature adjustment.
                                        Reference: 0.2% instant yeast for 24h at 20¬∞C.
                                    </p>
                                </div>
                            )}

                            {activeTab === 'temps' && (
                                <div className="card">
                                    <h2>Quick Summary</h2>
                                    
                                    <div className="info-box">
                                        <p><strong>{numPizzas} pizzas √ó {doughBallWeight}g</strong></p>
                                        <p>{currentStyle.name} ‚Ä¢ {currentStyle.hydration}% hydration</p>
                                        <p>Total flour: {getTotalFlour()}g</p>
                                        <p>Water temp: {getWaterTemp()}¬∞C</p>
                                    </div>

                                    <h3>Mixing Method</h3>
                                    <div className="success-box">
                                        <p><strong>Mixer:</strong> {mixerType.replace('_', ' ').toUpperCase()}</p>
                                        <p><strong>Friction Factor:</strong> {getFrictionFactor()}¬∞C</p>
                                        <p><strong>Target FDT:</strong> {currentStyle.finalDoughTemp}¬∞C</p>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'timeline' && (
                                <div className="card">
                                    <h2>Timeline</h2>
                                    <p className="small-text">
                                        {timelineMode === 'forward' ? 
                                            'Starting from now...' : 
                                            'Working backwards from bake time...'}
                                    </p>
                                    
                                    {generateTimeline().map((step, index) => (
                                        <div key={index} className="timeline-item">
                                            <strong>{step.time}</strong>
                                            <p style={{fontSize: '1.1rem', color: 'var(--primary)', margin: '0.5rem 0'}}>
                                                {step.action}
                                            </p>
                                            <p>{step.detail}</p>
                                            {step.temperature && (
                                                <p className="small-text" style={{marginTop: '0.5rem', color: 'var(--char-light)'}}>
                                                    {step.temperature}
                                                </p>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {activeTab === 'save' && (
                                <div className="card">
                                    <h2>Instructions</h2>
                                    
                                    <h3>Save Recipe</h3>
                                    <p>Saves your current configuration to browser storage. You can save multiple recipes and load them later.</p>

                                    <h3>Load Recipe</h3>
                                    <p>Load a previously saved recipe. All settings will be restored.</p>

                                    <h3>Export to Text</h3>
                                    <p>Downloads a complete text file with your recipe, timeline, and notes. Perfect for printing or sharing.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PizzaCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
